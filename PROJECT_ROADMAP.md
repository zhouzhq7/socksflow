# ğŸ§¦ SocksFlow å®Œæ•´åŠŸèƒ½å¼€å‘è·¯çº¿å›¾

## å½“å‰çŠ¶æ€
- âœ… åç«¯åŸºç¡€æ¡†æ¶ï¼ˆFastAPI + SQLiteï¼‰
- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•API
- âœ… Subscriptionæ¨¡å‹ï¼ˆåŸºç¡€ï¼‰
- âœ… å‰ç«¯é¦–é¡µå±•ç¤º
- âŒ ç¼ºå°‘è®¢é˜…ç®¡ç†API
- âŒ ç¼ºå°‘è®¢å•å’Œæ”¯ä»˜åŠŸèƒ½
- âŒ ç¼ºå°‘å‰ç«¯ç™»å½•/æ³¨å†Œé¡µé¢
- âŒ ç¼ºå°‘ç”¨æˆ·ä¸­å¿ƒ

---

## Phase 1: åç«¯æ•°æ®åº“æ¨¡å‹å®Œå–„

### 1.1 è®¢å•æ¨¡å‹ (Order)
```python
class Order:
    - id: int
    - user_id: int (FK)
    - subscription_id: int (FK, nullable)
    - order_number: str (å”¯ä¸€)
    - status: enum (pending, paid, shipped, delivered, cancelled)
    - total_amount: Decimal
    - items: JSON (è®¢å•é¡¹)
    - shipping_address: JSON
    - created_at: datetime
    - paid_at: datetime (nullable)
```

### 1.2 æ”¯ä»˜è®°å½•æ¨¡å‹ (Payment)
```python
class Payment:
    - id: int
    - user_id: int (FK)
    - order_id: int (FK)
    - amount: Decimal
    - provider: enum (alipay, wechat)
    - status: enum (pending, success, failed)
    - transaction_id: str (ç¬¬ä¸‰æ–¹äº¤æ˜“å·)
    - paid_at: datetime
```

### 1.3 å®Œå–„Subscriptionæ¨¡å‹
```python
# å·²æœ‰åŸºç¡€ï¼Œéœ€è¦æ·»åŠ ï¼š
- payment_method: str (æ”¯ä»˜æ–¹å¼)
- auto_renew: bool (è‡ªåŠ¨ç»­è´¹)
```

---

## Phase 2: åç«¯APIå¼€å‘

### 2.1 è®¢é˜…ç®¡ç†API (/api/v1/subscriptions)
```
POST   /subscriptions              # åˆ›å»ºè®¢é˜…
GET    /subscriptions              # è·å–å½“å‰ç”¨æˆ·è®¢é˜…åˆ—è¡¨
GET    /subscriptions/{id}         # è·å–è®¢é˜…è¯¦æƒ…
PUT    /subscriptions/{id}         # ä¿®æ”¹è®¢é˜…ï¼ˆåå¥½è®¾ç½®ï¼‰
POST   /subscriptions/{id}/pause   # æš‚åœè®¢é˜…
POST   /subscriptions/{id}/resume  # æ¢å¤è®¢é˜…
POST   /subscriptions/{id}/cancel  # å–æ¶ˆè®¢é˜…
```

### 2.2 è®¢å•ç®¡ç†API (/api/v1/orders)
```
POST   /orders              # åˆ›å»ºè®¢å•ï¼ˆç«‹å³è´­ä¹°æˆ–è®¢é˜…ç”Ÿæˆï¼‰
GET    /orders              # è·å–è®¢å•åˆ—è¡¨
GET    /orders/{id}         # è·å–è®¢å•è¯¦æƒ…
POST   /orders/{id}/cancel  # å–æ¶ˆè®¢å•
```

### 2.3 æ”¯ä»˜API (/api/v1/payments)
```
POST   /payments              # åˆ›å»ºæ”¯ä»˜
POST   /payments/alipay      # æ”¯ä»˜å®æ”¯ä»˜ï¼ˆè¿”å›æ”¯ä»˜URL/è¡¨å•ï¼‰
POST   /payments/wechat      # å¾®ä¿¡æ”¯ä»˜ï¼ˆè¿”å›æ”¯ä»˜å‚æ•°ï¼‰
POST   /payments/callback    # æ”¯ä»˜å›è°ƒï¼ˆå¼‚æ­¥é€šçŸ¥ï¼‰
GET    /payments/{id}/status # æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
```

---

## Phase 3: å‰ç«¯é¡µé¢å¼€å‘

### 3.1 è®¤è¯é¡µé¢
```
/app/auth/login     # ç™»å½•é¡µ
/app/auth/register  # æ³¨å†Œé¡µ
```

**ç™»å½•é¡µåŠŸèƒ½ï¼š**
- é‚®ç®±/å¯†ç è¾“å…¥
- è¡¨å•éªŒè¯
- ç™»å½•æˆåŠŸè·³è½¬
- Tokenå­˜å‚¨ï¼ˆlocalStorageï¼‰

**æ³¨å†Œé¡µåŠŸèƒ½ï¼š**
- é‚®ç®±/å¯†ç /å§“åè¾“å…¥
- è¡¨å•éªŒè¯
- æ³¨å†ŒæˆåŠŸè‡ªåŠ¨ç™»å½•

### 3.2 ç”¨æˆ·ä¸­å¿ƒ (/app/dashboard)
```
/app/dashboard              # ç”¨æˆ·ä¸­å¿ƒé¦–é¡µ
/app/dashboard/profile      # ä¸ªäººèµ„æ–™
/app/dashboard/orders       # è®¢å•å†å²
/app/dashboard/subscriptions # è®¢é˜…ç®¡ç†
```

**ç”¨æˆ·ä¸­å¿ƒåŠŸèƒ½ï¼š**
- å±•ç¤ºç”¨æˆ·ä¿¡æ¯
- å½“å‰è®¢é˜…çŠ¶æ€
- å¿«æ·æ“ä½œå…¥å£

### 3.3 è®¢é˜…ç®¡ç†é¡µ
**åŠŸèƒ½ï¼š**
- å±•ç¤ºå½“å‰è®¢é˜…è¯¦æƒ…
- ä¿®æ”¹è®¢é˜…åå¥½ï¼ˆé£æ ¼ã€å°ºç ï¼‰
- æš‚åœ/æ¢å¤/å–æ¶ˆè®¢é˜…æŒ‰é’®
- è®¢é˜…å†å²

### 3.4 æ”¯ä»˜é¡µé¢
```
/app/checkout?plan=basic    # è®¢é˜…ç»“è´¦é¡µ
/app/checkout?order_id=xxx  # è®¢å•ç»“è´¦é¡µ
```

**æ”¯ä»˜é¡µåŠŸèƒ½ï¼š**
- å±•ç¤ºè®¢å•è¯¦æƒ…
- é€‰æ‹©æ”¯ä»˜æ–¹å¼ï¼ˆæ”¯ä»˜å®/å¾®ä¿¡ï¼‰
- è°ƒç”¨æ”¯ä»˜æ¥å£
- æ”¯ä»˜çŠ¶æ€è½®è¯¢
- æ”¯ä»˜ç»“æœå±•ç¤º

---

## Phase 4: æ”¯ä»˜é›†æˆ

### 4.1 æ”¯ä»˜å®æ²™ç®±é›†æˆ
1. ç”³è¯·æ”¯ä»˜å®æ²™ç®±è´¦å·
2. é…ç½®åº”ç”¨ä¿¡æ¯
3. å®ç°æ”¯ä»˜å®SDKè°ƒç”¨
4. å¤„ç†åŒæ­¥/å¼‚æ­¥å›è°ƒ

### 4.2 å¾®ä¿¡æ”¯ä»˜ï¼ˆå¯é€‰ï¼‰
1. ç”³è¯·å¾®ä¿¡å•†æˆ·å·
2. é…ç½®APIå¯†é’¥
3. å®ç°ç»Ÿä¸€ä¸‹å•æ¥å£
4. å¤„ç†æ”¯ä»˜å›è°ƒ

---

## Phase 5: å‰åç«¯è”è°ƒ

### 5.1 è®¤è¯æµç¨‹æµ‹è¯•
- æ³¨å†Œ â†’ ç™»å½• â†’ Tokenå­˜å‚¨ â†’ å—ä¿æŠ¤è·¯ç”±è®¿é—®

### 5.2 è®¢é˜…æµç¨‹æµ‹è¯•
- é€‰æ‹©æ–¹æ¡ˆ â†’ åˆ›å»ºè®¢é˜… â†’ æ”¯ä»˜ â†’ æ¿€æ´»è®¢é˜…

### 5.3 è®¢å•æµç¨‹æµ‹è¯•
- åˆ›å»ºè®¢å• â†’ æ”¯ä»˜ â†’ è®¢å•çŠ¶æ€æ›´æ–° â†’ æŸ¥çœ‹è®¢å•

---

## æŠ€æœ¯è¦ç‚¹

### å‰ç«¯çŠ¶æ€ç®¡ç†
- ä½¿ç”¨ Zustand ç®¡ç†å…¨å±€çŠ¶æ€
- AuthStore: ç”¨æˆ·è®¤è¯çŠ¶æ€
- SubscriptionStore: è®¢é˜…çŠ¶æ€
- CartStore: è´­ç‰©è½¦ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰

### å‰ç«¯APIè°ƒç”¨
- å°è£… axios å®ä¾‹
- è‡ªåŠ¨æ·»åŠ  Authorization Header
- Tokenè¿‡æœŸè‡ªåŠ¨åˆ·æ–°

### åç«¯å®‰å…¨
- JWT Token è®¤è¯
- è¯·æ±‚é™æµ
- æ”¯ä»˜ç­¾åéªŒè¯

---

## æ–‡ä»¶ç»“æ„è§„åˆ’

```
sock-subscription/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/v1/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py           # å·²æœ‰
â”‚   â”‚   â”‚   â”œâ”€â”€ users.py          # å·²æœ‰
â”‚   â”‚   â”‚   â”œâ”€â”€ subscriptions.py  # æ–°å¢
â”‚   â”‚   â”‚   â”œâ”€â”€ orders.py         # æ–°å¢
â”‚   â”‚   â”‚   â””â”€â”€ payments.py       # æ–°å¢
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py           # å·²æœ‰
â”‚   â”‚   â”‚   â”œâ”€â”€ subscription.py   # å·²æœ‰ï¼Œéœ€å®Œå–„
â”‚   â”‚   â”‚   â”œâ”€â”€ order.py          # æ–°å¢
â”‚   â”‚   â”‚   â””â”€â”€ payment.py        # æ–°å¢
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â”œâ”€â”€ subscription_service.py  # æ–°å¢
â”‚   â”‚       â”œâ”€â”€ order_service.py         # æ–°å¢
â”‚   â”‚       â””â”€â”€ payment_service.py       # æ–°å¢
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ login/page.tsx    # æ–°å¢
â”‚   â”‚   â”‚   â””â”€â”€ register/page.tsx # æ–°å¢
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # æ–°å¢
â”‚   â”‚   â”‚   â”œâ”€â”€ subscriptions/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx      # æ–°å¢
â”‚   â”‚   â”‚   â””â”€â”€ orders/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # æ–°å¢
â”‚   â”‚   â””â”€â”€ checkout/
â”‚   â”‚       â””â”€â”€ page.tsx          # æ–°å¢
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ api.ts                # APIå°è£…ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â””â”€â”€ store/
â”‚   â”‚       â”œâ”€â”€ authStore.ts      # è®¤è¯çŠ¶æ€ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚       â””â”€â”€ subscriptionStore.ts # è®¢é˜…çŠ¶æ€ï¼ˆæ–°å¢ï¼‰
```

---

## å¼€å‘ä¼˜å…ˆçº§

1. **P0 (æ ¸å¿ƒ)** - é˜»å¡å…¶ä»–åŠŸèƒ½
   - ç™»å½•/æ³¨å†Œé¡µé¢
   - è®¢é˜…åˆ›å»ºAPI
   - ç”¨æˆ·ä¸­å¿ƒåŸºç¡€

2. **P1 (é‡è¦)** - ä¸»è¦åŠŸèƒ½
   - æ”¯ä»˜é›†æˆï¼ˆæ”¯ä»˜å®æ²™ç®±ï¼‰
   - è®¢é˜…ç®¡ç†ï¼ˆæš‚åœ/æ¢å¤/å–æ¶ˆï¼‰
   - è®¢å•ç®¡ç†

3. **P2 (ä¼˜åŒ–)** - æå‡ä½“éªŒ
   - å¾®ä¿¡æ”¯ä»˜
   - è®¢å•ç‰©æµè¿½è¸ª
   - ç”¨æˆ·è¯„ä»·
